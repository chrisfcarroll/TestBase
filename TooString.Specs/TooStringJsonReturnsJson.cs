using System.Dynamic;
using System.Numerics;
using System.Reflection;
using System.Text.Json;

namespace TooString.Specs;

[TestFixture]
public class TooStringJsonReturnsJson
{
    internal static readonly HttpClient httpClient = new HttpClient() { BaseAddress = new Uri("http://127.0.0.1") };

    [TestCase(null, "null")]
    [TestCase("boo", "\"boo\"")]
    [TestCase(1, "1")]
    [TestCase(1.2f, "1.2")]
    [TestCase(1.2d, "1.2")]
    public void GivenAScalar(object value, string expected)
    {
        Assert.That(value.TooString(TooStringHow.Json ), Is.EqualTo(expected));
    }

    [Test]
    public void GivenADate()
    {
        var now = DateTime.Now;
        //account for Json divergence from ToString("O") format if fractional seconds has trailing 0
        const long ticksPerTenthOfMicroSecond= TimeSpan.TicksPerSecond / 10_000_000;
        if (now.TimeOfDay.Ticks / ticksPerTenthOfMicroSecond % 10 == 0)
        {
            now = now.AddTicks(ticksPerTenthOfMicroSecond * 111);
        }

        Assert.That(
            now.TooString(TooStringHow.Json),
            Is.EqualTo($"\"{now.ToString("O")}\""));
    }

    [Test]
    public void GivenACompositeObject()
    {
        var value = new CompositeA { A = "boo", B = new Complex(3,4) };
        var expected = 
            "{\"A\":\"boo\",\"B\":{\"Real\":3,\"Imaginary\":4,\"Magnitude\":5,\"Phase\":0.9272952180016122}}";
        
        TestContext.Progress.WriteLine(value.TooString(TooStringHow.Json));
        
        Assert.That(
            value.TooString(TooStringHow.Json), 
            Is.EqualTo(expected) 
        );
    }

    [Test]
    public void GivenAnAnonymousObject()
    {
        var value = new { A = "boo", B = new Complex(3,4) };
        var expected = 
            "{\"A\":\"boo\",\"B\":{\"Real\":3,\"Imaginary\":4,\"Magnitude\":5,\"Phase\":0.9272952180016122}}";
        
        TestContext.Progress.WriteLine(value.TooString(TooStringHow.Json));
        
        Assert.That(
            value.TooString(TooStringHow.Json), 
            Is.EqualTo(expected) 
        );
    }
    
    [Test]
    public void WithCircularReferencesNulledOut__GivenCircularReferences()
    {
        var value = new Circular{ A = "boo"};
        value.B = value;
        var expected = 
            "{\"A\":\"boo\",\"B\":null}";
        
        Assert.That(
            value.TooString(TooStringHow.Json), 
            Is.EqualTo(expected) 
        );
    }
    
    [Test,Ignore("Don't create an HttpClient on every test run")]
    public void GivenDifficultObject()
    {
        var value = httpClient;
        var expected = 
            "{\"DefaultRequestHeaders\":[],\"DefaultRequestVersion\":\"1.1\"," +
            "\"DefaultVersionPolicy\":0,\"BaseAddress\":\"http://127.0.0.1\"," +
            "\"Timeout\":\"00:01:40\",\"MaxResponseContentBufferSize\":2147483647}";
        
        Assert.That(
            value.TooString(TooStringHow.Json), 
            Is.EqualTo(expected) 
        );
    }
    
    
    [Test]
    public void AndTestMethodsToRedactFilePathsDontBreakTheseTests()
    {
        var anAssembly = Assembly.GetExecutingAssembly();
        var actual = anAssembly.ManifestModule.FullyQualifiedName.TooString(TooStringHow.Json);
        var expected = "\"" +
                       /* expect Json to escape backslashes with backslashes */
                       Path.Combine(Directory.GetCurrentDirectory(), "TooString.Specs.dll").Replace("\\","\\\\") +
                       "\"";
        
        TestContext.Progress.WriteLine("""A single backslash looks like \""");
        TestContext.Progress.WriteLine(actual);
        
        Assert.That(
            actual.RegexReplaceKnownRuntimeVariableValues(),
            Is.EqualTo(expected.RegexReplaceKnownRuntimeVariableValues())
        );
        
        Assert.That(actual, Is.EqualTo(expected));
    }


#if NET6_0 // Expected values are hard-coded to a platform

    [Test]
    public void GivenNamedTupleReturnsJson()
    {
        var value = (one:1, two:"boo", three:false, four:UriKind.Absolute, five: new CompositeA{A = "A", B= new Complex(3,4)});

        var defaultJsonned = JsonSerializer.Serialize(value);

        var options = TooStringOptions.Default with
        {
            JsonOptions = new JsonSerializerOptions { IncludeFields = true }
        };

        var jsonnedIncludeFields = value.TooString(options);

        TestContext.Progress.WriteLine("jsonnedIncludeFields  :" + jsonnedIncludeFields);
        TestContext.Progress.WriteLine("defaultJsonned:" + defaultJsonned);
        TestContext.Progress.WriteLine("ToString:" + value);

        Assert.That(
            value.TooString(TooStringHow.Json),
            Is.EqualTo("""[1,"boo",false,"Absolute",{"A":"A","B":[3,4]}]"""));

        var valueAsAnonymousObject = new
        {
            Item1 = 1, Item2 = "boo", Item3 = false, Item4 = UriKind.Absolute,
            Item5 = new CompositeA { A = "A", B = new Complex(3, 4) }
        };
        Assert.That(
            jsonnedIncludeFields,
            Is.EqualTo( valueAsAnonymousObject.TooString(TooStringHow.Json)));
    }

    [Test]
    public void GivenAnUnJsonableReflectionType_Assembly()
    {
        //A
        var value = Assembly.GetExecutingAssembly();

        var expected = """
                       {"CodeBase":"file:///--filename--","FullName":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","EntryPoint":{"Name":"Main","DeclaringType":"AutoGeneratedProgram","ReflectedType":"AutoGeneratedProgram","MemberType":"Method","MetadataToken":100000000,"Module":{"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":{},"MetadataToken":100000000,"ScopeName":"TooString.Specs.dll","Name":"TooString.Specs.dll","Assembly":{"CodeBase":"file:///--filename--","FullName":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","EntryPoint":"Void Main(System.String[])","DefinedTypes":[],"IsCollectible":false,"ManifestModule":"TooString.Specs.dll","ReflectionOnly":false,"Location":"--filename--","ImageRuntimeVersion":"v4.0.30319","GlobalAssemblyCache":false,"HostContext":0,"IsDynamic":false,"ExportedTypes":[],"IsFullyTrusted":true,"CustomAttributes":[],"EscapedCodeBase":"file:///--filename--","Modules":[],"SecurityRuleSet":"None"},"ModuleHandle":{"MDStreamVersion":131072},"CustomAttributes":["[System.Runtime.CompilerServices.RefSafetyRulesAttribute((Int32)11)]"]},"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MethodHandle":{"Value":9999999999},"Attributes":"PrivateScope, Private, Static, HideBySig","CallingConvention":"Standard","ReturnType":"System.Void","ReturnTypeCustomAttributes":{"ParameterType":"System.Void","Name":"null","HasDefaultValue":true,"DefaultValue":"null","RawDefaultValue":"null","MetadataToken":100000000,"Attributes":"None","Member":{"Name":"Main","DeclaringType":"AutoGeneratedProgram","ReflectedType":"AutoGeneratedProgram","MemberType":"Method","MetadataToken":100000000,"Module":"TooString.Specs.dll","IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MethodHandle":"System.RuntimeMethodHandle","Attributes":"PrivateScope, Private, Static, HideBySig","CallingConvention":"Standard","ReturnType":"System.Void","ReturnTypeCustomAttributes":"Void","ReturnParameter":"Void","IsCollectible":false,"IsGenericMethod":false,"IsGenericMethodDefinition":false,"ContainsGenericParameters":false,"MethodImplementationFlags":"Managed","IsAbstract":false,"IsConstructor":false,"IsFinal":false,"IsHideBySig":true,"IsSpecialName":false,"IsStatic":true,"IsVirtual":false,"IsAssembly":false,"IsFamily":false,"IsFamilyAndAssembly":false,"IsFamilyOrAssembly":false,"IsPrivate":true,"IsPublic":false,"IsConstructedGenericMethod":false,"CustomAttributes":[]},"Position":-1,"IsIn":false,"IsLcid":false,"IsOptional":false,"IsOut":false,"IsRetval":false,"CustomAttributes":[]},"ReturnParameter":{"ParameterType":"System.Void","Name":"null","HasDefaultValue":true,"DefaultValue":"null","RawDefaultValue":"null","MetadataToken":100000000,"Attributes":"None","Member":{"Name":"Main","DeclaringType":"AutoGeneratedProgram","ReflectedType":"AutoGeneratedProgram","MemberType":"Method","MetadataToken":100000000,"Module":"TooString.Specs.dll","IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MethodHandle":"System.RuntimeMethodHandle","Attributes":"PrivateScope, Private, Static, HideBySig","CallingConvention":"Standard","ReturnType":"System.Void","ReturnTypeCustomAttributes":"Void","ReturnParameter":"Void","IsCollectible":false,"IsGenericMethod":false,"IsGenericMethodDefinition":false,"ContainsGenericParameters":false,"MethodImplementationFlags":"Managed","IsAbstract":false,"IsConstructor":false,"IsFinal":false,"IsHideBySig":true,"IsSpecialName":false,"IsStatic":true,"IsVirtual":false,"IsAssembly":false,"IsFamily":false,"IsFamilyAndAssembly":false,"IsFamilyOrAssembly":false,"IsPrivate":true,"IsPublic":false,"IsConstructedGenericMethod":false,"CustomAttributes":[]},"Position":-1,"IsIn":false,"IsLcid":false,"IsOptional":false,"IsOut":false,"IsRetval":false,"CustomAttributes":[]},"IsCollectible":false,"IsGenericMethod":false,"IsGenericMethodDefinition":false,"ContainsGenericParameters":false,"MethodImplementationFlags":"Managed","IsAbstract":false,"IsConstructor":false,"IsFinal":false,"IsHideBySig":true,"IsSpecialName":false,"IsStatic":true,"IsVirtual":false,"IsAssembly":false,"IsFamily":false,"IsFamilyAndAssembly":false,"IsFamilyOrAssembly":false,"IsPrivate":true,"IsPublic":false,"IsConstructedGenericMethod":false,"CustomAttributes":[]},"DefinedTypes":[{"IsCollectible":false,"DeclaringMethod":"MethodBase","FullName":"\u003C\u003Ef__AnonymousType0\u00602","AssemblyQualifiedName":"\u003C\u003Ef__AnonymousType0\u00602, TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","Namespace":"null","GUID":{},"GenericParameterAttributes":"GenericParameterAttributes","IsSZArray":false,"GenericParameterPosition":"Int32","ContainsGenericParameters":true,"StructLayoutAttribute":{"Value":"Auto","TypeId":"System.Runtime.InteropServices.StructLayoutAttribute"},"Name":"\u003C\u003Ef__AnonymousType0\u00602","DeclaringType":"null","Assembly":{"CodeBase":"file:///--filename--","FullName":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","EntryPoint":"Void Main(System.String[])","DefinedTypes":[],"IsCollectible":false,"ManifestModule":"TooString.Specs.dll","ReflectionOnly":false,"Location":"--filename--","ImageRuntimeVersion":"v4.0.30319","GlobalAssemblyCache":false,"HostContext":0,"IsDynamic":false,"ExportedTypes":[],"IsFullyTrusted":true,"CustomAttributes":[],"EscapedCodeBase":"file:///--filename--","Modules":[],"SecurityRuleSet":"None"},"BaseType":"System.Object","IsByRefLike":false,"IsConstructedGenericType":false,"IsGenericType":true,"IsGenericTypeDefinition":true,"IsGenericParameter":false,"IsTypeDefinition":true,"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MemberType":"TypeInfo","MetadataToken":100000000,"Module":{"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":"00000000-0000-0000-0000-000000000000","MetadataToken":100000000,"ScopeName":"TooString.Specs.dll","Name":"TooString.Specs.dll","Assembly":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","ModuleHandle":"System.ModuleHandle","CustomAttributes":[]},"ReflectedType":"null","TypeHandle":{"Value":9999999999},"UnderlyingSystemType":"\u003C\u003Ef__AnonymousType0\u00602","GenericTypeParameters":[".\u003CA\u003Ej__TPar",".\u003CB\u003Ej__TPar"],"DeclaredConstructors":["Void .ctor(\u003CA\u003Ej__TPar, \u003CB\u003Ej__TPar)"],"DeclaredEvents":[],"DeclaredFields":["\u003CA\u003Ej__TPar \u003CA\u003Ei__Field","\u003CB\u003Ej__TPar \u003CB\u003Ei__Field"],"DeclaredMembers":["\u003CA\u003Ej__TPar get_A()","\u003CB\u003Ej__TPar get_B()","Boolean Equals(System.Object)"],"DeclaredMethods":["\u003CA\u003Ej__TPar get_A()","\u003CB\u003Ej__TPar get_B()","Boolean Equals(System.Object)"],"DeclaredNestedTypes":[],"DeclaredProperties":["\u003CA\u003Ej__TPar A","\u003CB\u003Ej__TPar B"],"ImplementedInterfaces":[],"IsInterface":false,"IsNested":false,"IsArray":false,"IsByRef":false,"IsPointer":false,"IsGenericTypeParameter":false,"IsGenericMethodParameter":false,"IsVariableBoundArray":false,"HasElementType":false,"GenericTypeArguments":[],"Attributes":"AutoLayout, AnsiClass, Class, Sealed, BeforeFieldInit","IsAbstract":false,"IsImport":false,"IsSealed":true,"IsSpecialName":false,"IsClass":true,"IsNestedAssembly":false,"IsNestedFamANDAssem":false,"IsNestedFamily":false,"IsNestedFamORAssem":false,"IsNestedPrivate":false,"IsNestedPublic":false,"IsNotPublic":true,"IsPublic":false,"IsAutoLayout":true,"IsExplicitLayout":false,"IsLayoutSequential":false,"IsAnsiClass":true,"IsAutoClass":false,"IsUnicodeClass":false,"IsCOMObject":false,"IsContextful":false,"IsEnum":false,"IsMarshalByRef":false,"IsPrimitive":false,"IsValueType":false,"IsSignatureType":false,"TypeInitializer":"null","IsSerializable":false,"IsVisible":false,"CustomAttributes":["[System.Runtime.CompilerServices.CompilerGeneratedAttribute()]","[System.Diagnostics.DebuggerDisplayAttribute(\u0022\\{ A = {A}, B = {B} }\u0022, Type = \u0022\u003CAnonymous Type\u003E\u0022)]"]},{"IsCollectible":false,"DeclaringMethod":"MethodBase","FullName":"\u003C\u003Ef__AnonymousType1\u00605","AssemblyQualifiedName":"\u003C\u003Ef__AnonymousType1\u00605, TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","Namespace":"null","GUID":{},"GenericParameterAttributes":"GenericParameterAttributes","IsSZArray":false,"GenericParameterPosition":"Int32","ContainsGenericParameters":true,"StructLayoutAttribute":{"Value":"Auto","TypeId":"System.Runtime.InteropServices.StructLayoutAttribute"},"Name":"\u003C\u003Ef__AnonymousType1\u00605","DeclaringType":"null","Assembly":{"CodeBase":"file:///--filename--","FullName":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","EntryPoint":"Void Main(System.String[])","DefinedTypes":[],"IsCollectible":false,"ManifestModule":"TooString.Specs.dll","ReflectionOnly":false,"Location":"--filename--","ImageRuntimeVersion":"v4.0.30319","GlobalAssemblyCache":false,"HostContext":0,"IsDynamic":false,"ExportedTypes":[],"IsFullyTrusted":true,"CustomAttributes":[],"EscapedCodeBase":"file:///--filename--","Modules":[],"SecurityRuleSet":"None"},"BaseType":"System.Object","IsByRefLike":false,"IsConstructedGenericType":false,"IsGenericType":true,"IsGenericTypeDefinition":true,"IsGenericParameter":false,"IsTypeDefinition":true,"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MemberType":"TypeInfo","MetadataToken":100000000,"Module":{"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":"00000000-0000-0000-0000-000000000000","MetadataToken":100000000,"ScopeName":"TooString.Specs.dll","Name":"TooString.Specs.dll","Assembly":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","ModuleHandle":"System.ModuleHandle","CustomAttributes":[]},"ReflectedType":"null","TypeHandle":{"Value":9999999999},"UnderlyingSystemType":"\u003C\u003Ef__AnonymousType1\u00605","GenericTypeParameters":[".\u003CItem1\u003Ej__TPar",".\u003CItem2\u003Ej__TPar",".\u003CItem3\u003Ej__TPar"],"DeclaredConstructors":["Void .ctor(\u003CItem1\u003Ej__TPar, \u003CItem2\u003Ej__TPar, \u003CItem3\u003Ej__TPar, \u003CItem4\u003Ej__TPar, \u003CItem5\u003Ej__TPar)"],"DeclaredEvents":[],"DeclaredFields":["\u003CItem1\u003Ej__TPar \u003CItem1\u003Ei__Field","\u003CItem2\u003Ej__TPar \u003CItem2\u003Ei__Field","\u003CItem3\u003Ej__TPar \u003CItem3\u003Ei__Field"],"DeclaredMembers":["\u003CItem1\u003Ej__TPar get_Item1()","\u003CItem2\u003Ej__TPar get_Item2()","\u003CItem3\u003Ej__TPar get_Item3()"],"DeclaredMethods":["\u003CItem1\u003Ej__TPar get_Item1()","\u003CItem2\u003Ej__TPar get_Item2()","\u003CItem3\u003Ej__TPar get_Item3()"],"DeclaredNestedTypes":[],"DeclaredProperties":["\u003CItem1\u003Ej__TPar Item1","\u003CItem2\u003Ej__TPar Item2","\u003CItem3\u003Ej__TPar Item3"],"ImplementedInterfaces":[],"IsInterface":false,"IsNested":false,"IsArray":false,"IsByRef":false,"IsPointer":false,"IsGenericTypeParameter":false,"IsGenericMethodParameter":false,"IsVariableBoundArray":false,"HasElementType":false,"GenericTypeArguments":[],"Attributes":"AutoLayout, AnsiClass, Class, Sealed, BeforeFieldInit","IsAbstract":false,"IsImport":false,"IsSealed":true,"IsSpecialName":false,"IsClass":true,"IsNestedAssembly":false,"IsNestedFamANDAssem":false,"IsNestedFamily":false,"IsNestedFamORAssem":false,"IsNestedPrivate":false,"IsNestedPublic":false,"IsNotPublic":true,"IsPublic":false,"IsAutoLayout":true,"IsExplicitLayout":false,"IsLayoutSequential":false,"IsAnsiClass":true,"IsAutoClass":false,"IsUnicodeClass":false,"IsCOMObject":false,"IsContextful":false,"IsEnum":false,"IsMarshalByRef":false,"IsPrimitive":false,"IsValueType":false,"IsSignatureType":false,"TypeInitializer":"null","IsSerializable":false,"IsVisible":false,"CustomAttributes":["[System.Runtime.CompilerServices.CompilerGeneratedAttribute()]","[System.Diagnostics.DebuggerDisplayAttribute(\u0022\\{ Item1 = {Item1}, Item2 = {Item2}, Item3 = {Item3}, Item4 = {Item4}, Item5 = {Item5} }\u0022, Type = \u0022\u003CAnonymous Type\u003E\u0022)]"]},{"IsCollectible":false,"DeclaringMethod":"MethodBase","FullName":"\u003C\u003Ef__AnonymousType2\u00605","AssemblyQualifiedName":"\u003C\u003Ef__AnonymousType2\u00605, TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","Namespace":"null","GUID":{},"GenericParameterAttributes":"GenericParameterAttributes","IsSZArray":false,"GenericParameterPosition":"Int32","ContainsGenericParameters":true,"StructLayoutAttribute":{"Value":"Auto","TypeId":"System.Runtime.InteropServices.StructLayoutAttribute"},"Name":"\u003C\u003Ef__AnonymousType2\u00605","DeclaringType":"null","Assembly":{"CodeBase":"file:///--filename--","FullName":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","EntryPoint":"Void Main(System.String[])","DefinedTypes":[],"IsCollectible":false,"ManifestModule":"TooString.Specs.dll","ReflectionOnly":false,"Location":"--filename--","ImageRuntimeVersion":"v4.0.30319","GlobalAssemblyCache":false,"HostContext":0,"IsDynamic":false,"ExportedTypes":[],"IsFullyTrusted":true,"CustomAttributes":[],"EscapedCodeBase":"file:///--filename--","Modules":[],"SecurityRuleSet":"None"},"BaseType":"System.Object","IsByRefLike":false,"IsConstructedGenericType":false,"IsGenericType":true,"IsGenericTypeDefinition":true,"IsGenericParameter":false,"IsTypeDefinition":true,"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MemberType":"TypeInfo","MetadataToken":100000000,"Module":{"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":"00000000-0000-0000-0000-000000000000","MetadataToken":100000000,"ScopeName":"TooString.Specs.dll","Name":"TooString.Specs.dll","Assembly":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","ModuleHandle":"System.ModuleHandle","CustomAttributes":[]},"ReflectedType":"null","TypeHandle":{"Value":9999999999},"UnderlyingSystemType":"\u003C\u003Ef__AnonymousType2\u00605","GenericTypeParameters":[".\u003Cone\u003Ej__TPar",".\u003Ctwo\u003Ej__TPar",".\u003Cthree\u003Ej__TPar"],"DeclaredConstructors":["Void .ctor(\u003Cone\u003Ej__TPar, \u003Ctwo\u003Ej__TPar, \u003Cthree\u003Ej__TPar, \u003Cfour\u003Ej__TPar, \u003Cfive\u003Ej__TPar)"],"DeclaredEvents":[],"DeclaredFields":["\u003Cone\u003Ej__TPar \u003Cone\u003Ei__Field","\u003Ctwo\u003Ej__TPar \u003Ctwo\u003Ei__Field","\u003Cthree\u003Ej__TPar \u003Cthree\u003Ei__Field"],"DeclaredMembers":["\u003Cone\u003Ej__TPar get_one()","\u003Ctwo\u003Ej__TPar get_two()","\u003Cthree\u003Ej__TPar get_three()"],"DeclaredMethods":["\u003Cone\u003Ej__TPar get_one()","\u003Ctwo\u003Ej__TPar get_two()","\u003Cthree\u003Ej__TPar get_three()"],"DeclaredNestedTypes":[],"DeclaredProperties":["\u003Cone\u003Ej__TPar one","\u003Ctwo\u003Ej__TPar two","\u003Cthree\u003Ej__TPar three"],"ImplementedInterfaces":[],"IsInterface":false,"IsNested":false,"IsArray":false,"IsByRef":false,"IsPointer":false,"IsGenericTypeParameter":false,"IsGenericMethodParameter":false,"IsVariableBoundArray":false,"HasElementType":false,"GenericTypeArguments":[],"Attributes":"AutoLayout, AnsiClass, Class, Sealed, BeforeFieldInit","IsAbstract":false,"IsImport":false,"IsSealed":true,"IsSpecialName":false,"IsClass":true,"IsNestedAssembly":false,"IsNestedFamANDAssem":false,"IsNestedFamily":false,"IsNestedFamORAssem":false,"IsNestedPrivate":false,"IsNestedPublic":false,"IsNotPublic":true,"IsPublic":false,"IsAutoLayout":true,"IsExplicitLayout":false,"IsLayoutSequential":false,"IsAnsiClass":true,"IsAutoClass":false,"IsUnicodeClass":false,"IsCOMObject":false,"IsContextful":false,"IsEnum":false,"IsMarshalByRef":false,"IsPrimitive":false,"IsValueType":false,"IsSignatureType":false,"TypeInitializer":"null","IsSerializable":false,"IsVisible":false,"CustomAttributes":["[System.Runtime.CompilerServices.CompilerGeneratedAttribute()]","[System.Diagnostics.DebuggerDisplayAttribute(\u0022\\{ one = {one}, two = {two}, three = {three}, four = {four}, five = {five} }\u0022, Type = \u0022\u003CAnonymous Type\u003E\u0022)]"]}],"IsCollectible":false,"ManifestModule":{"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":{},"MetadataToken":100000000,"ScopeName":"TooString.Specs.dll","Name":"TooString.Specs.dll","Assembly":{"CodeBase":"file:///--filename--","FullName":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","EntryPoint":{"Name":"Main","DeclaringType":"AutoGeneratedProgram","ReflectedType":"AutoGeneratedProgram","MemberType":"Method","MetadataToken":100000000,"Module":"TooString.Specs.dll","IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MethodHandle":"System.RuntimeMethodHandle","Attributes":"PrivateScope, Private, Static, HideBySig","CallingConvention":"Standard","ReturnType":"System.Void","ReturnTypeCustomAttributes":"Void","ReturnParameter":"Void","IsCollectible":false,"IsGenericMethod":false,"IsGenericMethodDefinition":false,"ContainsGenericParameters":false,"MethodImplementationFlags":"Managed","IsAbstract":false,"IsConstructor":false,"IsFinal":false,"IsHideBySig":true,"IsSpecialName":false,"IsStatic":true,"IsVirtual":false,"IsAssembly":false,"IsFamily":false,"IsFamilyAndAssembly":false,"IsFamilyOrAssembly":false,"IsPrivate":true,"IsPublic":false,"IsConstructedGenericMethod":false,"CustomAttributes":[]},"DefinedTypes":["\u003C\u003Ef__AnonymousType0\u00602","\u003C\u003Ef__AnonymousType1\u00605","\u003C\u003Ef__AnonymousType2\u00605"],"IsCollectible":false,"ManifestModule":{"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":"00000000-0000-0000-0000-000000000000","MetadataToken":100000000,"ScopeName":"TooString.Specs.dll","Name":"TooString.Specs.dll","Assembly":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","ModuleHandle":"System.ModuleHandle","CustomAttributes":[]},"ReflectionOnly":false,"Location":"--filename--","ImageRuntimeVersion":"v4.0.30319","GlobalAssemblyCache":false,"HostContext":0,"IsDynamic":false,"ExportedTypes":["TooString.Specs.TooStringBestEffortMakesGoodChoices","TooString.Specs.TooStringCallerArgumentExpressionReturnsLiteralCode","TooString.Specs.TooStringJsonReturnsJson"],"IsFullyTrusted":true,"CustomAttributes":["[System.Runtime.CompilerServices.CompilationRelaxationsAttribute((Int32)8)]","[System.Runtime.CompilerServices.RuntimeCompatibilityAttribute(WrapNonExceptionThrows = True)]","[System.Diagnostics.DebuggableAttribute((System.Diagnostics.DebuggableAttribute\u002BDebuggingModes)263)]"],"EscapedCodeBase":"file:///--filename--","Modules":["TooString.Specs.dll"],"SecurityRuleSet":"None"},"ModuleHandle":{"MDStreamVersion":131072},"CustomAttributes":[{"Constructor":"Void .ctor(Int32)","ConstructorArguments":[],"NamedArguments":[],"AttributeType":"System.Runtime.CompilerServices.RefSafetyRulesAttribute"}]},"ReflectionOnly":false,"Location":"--filename--","ImageRuntimeVersion":"v4.0.30319","GlobalAssemblyCache":false,"HostContext":0,"IsDynamic":false,"ExportedTypes":[{"IsCollectible":false,"DeclaringMethod":"MethodBase","FullName":"TooString.Specs.TooStringBestEffortMakesGoodChoices","AssemblyQualifiedName":"TooString.Specs.TooStringBestEffortMakesGoodChoices, TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","Namespace":"TooString.Specs","GUID":{},"GenericParameterAttributes":"GenericParameterAttributes","IsSZArray":false,"GenericParameterPosition":"Int32","ContainsGenericParameters":false,"StructLayoutAttribute":{"Value":"Auto","TypeId":"System.Runtime.InteropServices.StructLayoutAttribute"},"Name":"TooStringBestEffortMakesGoodChoices","DeclaringType":"null","Assembly":{"CodeBase":"file:///--filename--","FullName":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","EntryPoint":"Void Main(System.String[])","DefinedTypes":[],"IsCollectible":false,"ManifestModule":"TooString.Specs.dll","ReflectionOnly":false,"Location":"--filename--","ImageRuntimeVersion":"v4.0.30319","GlobalAssemblyCache":false,"HostContext":0,"IsDynamic":false,"ExportedTypes":[],"IsFullyTrusted":true,"CustomAttributes":[],"EscapedCodeBase":"file:///--filename--","Modules":[],"SecurityRuleSet":"None"},"BaseType":"System.Object","IsByRefLike":false,"IsConstructedGenericType":false,"IsGenericType":false,"IsGenericTypeDefinition":false,"IsGenericParameter":false,"IsTypeDefinition":true,"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MemberType":"TypeInfo","MetadataToken":100000000,"Module":{"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":"00000000-0000-0000-0000-000000000000","MetadataToken":100000000,"ScopeName":"TooString.Specs.dll","Name":"TooString.Specs.dll","Assembly":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","ModuleHandle":"System.ModuleHandle","CustomAttributes":[]},"ReflectedType":"null","TypeHandle":{"Value":9999999999},"UnderlyingSystemType":"TooString.Specs.TooStringBestEffortMakesGoodChoices","GenericTypeParameters":[],"DeclaredConstructors":["Void .ctor()"],"DeclaredEvents":[],"DeclaredFields":[],"DeclaredMembers":["Void GivenAScalar__ReturnsJson(System.Object, System.String)","Void GivenACompositeObject__ReturnsJson()","Void GivenACompositeObjectAndDefaultOptions__ReturnsJson()"],"DeclaredMethods":["Void GivenAScalar__ReturnsJson(System.Object, System.String)","Void GivenACompositeObject__ReturnsJson()","Void GivenACompositeObjectAndDefaultOptions__ReturnsJson()"],"DeclaredNestedTypes":["TooString.Specs.TooStringBestEffortMakesGoodChoices\u002B\u003C\u003Ec"],"DeclaredProperties":[],"ImplementedInterfaces":[],"IsInterface":false,"IsNested":false,"IsArray":false,"IsByRef":false,"IsPointer":false,"IsGenericTypeParameter":false,"IsGenericMethodParameter":false,"IsVariableBoundArray":false,"HasElementType":false,"GenericTypeArguments":[],"Attributes":"AutoLayout, AnsiClass, Class, Public, BeforeFieldInit","IsAbstract":false,"IsImport":false,"IsSealed":false,"IsSpecialName":false,"IsClass":true,"IsNestedAssembly":false,"IsNestedFamANDAssem":false,"IsNestedFamily":false,"IsNestedFamORAssem":false,"IsNestedPrivate":false,"IsNestedPublic":false,"IsNotPublic":false,"IsPublic":true,"IsAutoLayout":true,"IsExplicitLayout":false,"IsLayoutSequential":false,"IsAnsiClass":true,"IsAutoClass":false,"IsUnicodeClass":false,"IsCOMObject":false,"IsContextful":false,"IsEnum":false,"IsMarshalByRef":false,"IsPrimitive":false,"IsValueType":false,"IsSignatureType":false,"TypeInitializer":"null","IsSerializable":false,"IsVisible":true,"CustomAttributes":["[NUnit.Framework.TestFixtureAttribute()]"]},{"IsCollectible":false,"DeclaringMethod":"MethodBase","FullName":"TooString.Specs.TooStringCallerArgumentExpressionReturnsLiteralCode","AssemblyQualifiedName":"TooString.Specs.TooStringCallerArgumentExpressionReturnsLiteralCode, TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","Namespace":"TooString.Specs","GUID":{},"GenericParameterAttributes":"GenericParameterAttributes","IsSZArray":false,"GenericParameterPosition":"Int32","ContainsGenericParameters":false,"StructLayoutAttribute":{"Value":"Auto","TypeId":"System.Runtime.InteropServices.StructLayoutAttribute"},"Name":"TooStringCallerArgumentExpressionReturnsLiteralCode","DeclaringType":"null","Assembly":{"CodeBase":"file:///--filename--","FullName":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","EntryPoint":"Void Main(System.String[])","DefinedTypes":[],"IsCollectible":false,"ManifestModule":"TooString.Specs.dll","ReflectionOnly":false,"Location":"--filename--","ImageRuntimeVersion":"v4.0.30319","GlobalAssemblyCache":false,"HostContext":0,"IsDynamic":false,"ExportedTypes":[],"IsFullyTrusted":true,"CustomAttributes":[],"EscapedCodeBase":"file:///--filename--","Modules":[],"SecurityRuleSet":"None"},"BaseType":"System.Object","IsByRefLike":false,"IsConstructedGenericType":false,"IsGenericType":false,"IsGenericTypeDefinition":false,"IsGenericParameter":false,"IsTypeDefinition":true,"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MemberType":"TypeInfo","MetadataToken":100000000,"Module":{"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":"00000000-0000-0000-0000-000000000000","MetadataToken":100000000,"ScopeName":"TooString.Specs.dll","Name":"TooString.Specs.dll","Assembly":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","ModuleHandle":"System.ModuleHandle","CustomAttributes":[]},"ReflectedType":"null","TypeHandle":{"Value":9999999999},"UnderlyingSystemType":"TooString.Specs.TooStringCallerArgumentExpressionReturnsLiteralCode","GenericTypeParameters":[],"DeclaredConstructors":["Void .ctor()"],"DeclaredEvents":[],"DeclaredFields":[],"DeclaredMembers":["Void GivenASimpleExpression()","Void GivenACollectionExpression()","Void GivenAnObjectInitializer()"],"DeclaredMethods":["Void GivenASimpleExpression()","Void GivenACollectionExpression()","Void GivenAnObjectInitializer()"],"DeclaredNestedTypes":["TooString.Specs.TooStringCallerArgumentExpressionReturnsLiteralCode\u002B\u003C\u003Ec__DisplayClass1_0"],"DeclaredProperties":[],"ImplementedInterfaces":[],"IsInterface":false,"IsNested":false,"IsArray":false,"IsByRef":false,"IsPointer":false,"IsGenericTypeParameter":false,"IsGenericMethodParameter":false,"IsVariableBoundArray":false,"HasElementType":false,"GenericTypeArguments":[],"Attributes":"AutoLayout, AnsiClass, Class, Public, BeforeFieldInit","IsAbstract":false,"IsImport":false,"IsSealed":false,"IsSpecialName":false,"IsClass":true,"IsNestedAssembly":false,"IsNestedFamANDAssem":false,"IsNestedFamily":false,"IsNestedFamORAssem":false,"IsNestedPrivate":false,"IsNestedPublic":false,"IsNotPublic":false,"IsPublic":true,"IsAutoLayout":true,"IsExplicitLayout":false,"IsLayoutSequential":false,"IsAnsiClass":true,"IsAutoClass":false,"IsUnicodeClass":false,"IsCOMObject":false,"IsContextful":false,"IsEnum":false,"IsMarshalByRef":false,"IsPrimitive":false,"IsValueType":false,"IsSignatureType":false,"TypeInitializer":"null","IsSerializable":false,"IsVisible":true,"CustomAttributes":["[NUnit.Framework.TestFixtureAttribute()]"]},{"IsCollectible":false,"DeclaringMethod":"MethodBase","FullName":"TooString.Specs.TooStringJsonReturnsJson","AssemblyQualifiedName":"TooString.Specs.TooStringJsonReturnsJson, TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","Namespace":"TooString.Specs","GUID":{},"GenericParameterAttributes":"GenericParameterAttributes","IsSZArray":false,"GenericParameterPosition":"Int32","ContainsGenericParameters":false,"StructLayoutAttribute":{"Value":"Auto","TypeId":"System.Runtime.InteropServices.StructLayoutAttribute"},"Name":"TooStringJsonReturnsJson","DeclaringType":"null","Assembly":{"CodeBase":"file:///--filename--","FullName":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","EntryPoint":"Void Main(System.String[])","DefinedTypes":[],"IsCollectible":false,"ManifestModule":"TooString.Specs.dll","ReflectionOnly":false,"Location":"--filename--","ImageRuntimeVersion":"v4.0.30319","GlobalAssemblyCache":false,"HostContext":0,"IsDynamic":false,"ExportedTypes":[],"IsFullyTrusted":true,"CustomAttributes":[],"EscapedCodeBase":"file:///--filename--","Modules":[],"SecurityRuleSet":"None"},"BaseType":"System.Object","IsByRefLike":false,"IsConstructedGenericType":false,"IsGenericType":false,"IsGenericTypeDefinition":false,"IsGenericParameter":false,"IsTypeDefinition":true,"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MemberType":"TypeInfo","MetadataToken":100000000,"Module":{"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":"00000000-0000-0000-0000-000000000000","MetadataToken":100000000,"ScopeName":"TooString.Specs.dll","Name":"TooString.Specs.dll","Assembly":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","ModuleHandle":"System.ModuleHandle","CustomAttributes":[]},"ReflectedType":"null","TypeHandle":{"Value":9999999999},"UnderlyingSystemType":"TooString.Specs.TooStringJsonReturnsJson","GenericTypeParameters":[],"DeclaredConstructors":["Void .ctor()","Void .cctor()"],"DeclaredEvents":[],"DeclaredFields":["System.Net.Http.HttpClient httpClient"],"DeclaredMembers":["Void GivenAScalar(System.Object, System.String)","Void GivenADate()","Void GivenACompositeObject()"],"DeclaredMethods":["Void GivenAScalar(System.Object, System.String)","Void GivenADate()","Void GivenACompositeObject()"],"DeclaredNestedTypes":["TooString.Specs.TooStringJsonReturnsJson\u002B\u003C\u003Ec"],"DeclaredProperties":[],"ImplementedInterfaces":[],"IsInterface":false,"IsNested":false,"IsArray":false,"IsByRef":false,"IsPointer":false,"IsGenericTypeParameter":false,"IsGenericMethodParameter":false,"IsVariableBoundArray":false,"HasElementType":false,"GenericTypeArguments":[],"Attributes":"AutoLayout, AnsiClass, Class, Public, BeforeFieldInit","IsAbstract":false,"IsImport":false,"IsSealed":false,"IsSpecialName":false,"IsClass":true,"IsNestedAssembly":false,"IsNestedFamANDAssem":false,"IsNestedFamily":false,"IsNestedFamORAssem":false,"IsNestedPrivate":false,"IsNestedPublic":false,"IsNotPublic":false,"IsPublic":true,"IsAutoLayout":true,"IsExplicitLayout":false,"IsLayoutSequential":false,"IsAnsiClass":true,"IsAutoClass":false,"IsUnicodeClass":false,"IsCOMObject":false,"IsContextful":false,"IsEnum":false,"IsMarshalByRef":false,"IsPrimitive":false,"IsValueType":false,"IsSignatureType":false,"TypeInitializer":{"Name":".cctor","MemberType":"Constructor","DeclaringType":"TooString.Specs.TooStringJsonReturnsJson","ReflectedType":"TooString.Specs.TooStringJsonReturnsJson","MetadataToken":100000000,"Module":"TooString.Specs.dll","MethodHandle":"System.RuntimeMethodHandle","Attributes":"PrivateScope, Private, Static, HideBySig, SpecialName, RTSpecialName","CallingConvention":"Standard","IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"ContainsGenericParameters":false,"MethodImplementationFlags":"Managed","IsAbstract":false,"IsConstructor":false,"IsFinal":false,"IsHideBySig":true,"IsSpecialName":true,"IsStatic":true,"IsVirtual":false,"IsAssembly":false,"IsFamily":false,"IsFamilyAndAssembly":false,"IsFamilyOrAssembly":false,"IsPrivate":true,"IsPublic":false,"IsConstructedGenericMethod":false,"IsGenericMethod":false,"IsGenericMethodDefinition":false,"CustomAttributes":[],"IsCollectible":true},"IsSerializable":false,"IsVisible":true,"CustomAttributes":["[System.Runtime.CompilerServices.NullableContextAttribute((Byte)1)]","[System.Runtime.CompilerServices.NullableAttribute((Byte)0)]","[NUnit.Framework.TestFixtureAttribute()]"]}],"IsFullyTrusted":true,"CustomAttributes":[{"Constructor":{"Name":".ctor","MemberType":"Constructor","DeclaringType":"System.Runtime.CompilerServices.CompilationRelaxationsAttribute","ReflectedType":"System.Runtime.CompilerServices.CompilationRelaxationsAttribute","MetadataToken":100000000,"Module":"System.Private.CoreLib.dll","MethodHandle":"System.RuntimeMethodHandle","Attributes":"PrivateScope, Public, HideBySig, SpecialName, RTSpecialName","CallingConvention":"Standard, HasThis","IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"ContainsGenericParameters":false,"MethodImplementationFlags":"Managed","IsAbstract":false,"IsConstructor":true,"IsFinal":false,"IsHideBySig":true,"IsSpecialName":true,"IsStatic":false,"IsVirtual":false,"IsAssembly":false,"IsFamily":false,"IsFamilyAndAssembly":false,"IsFamilyOrAssembly":false,"IsPrivate":false,"IsPublic":true,"IsConstructedGenericMethod":false,"IsGenericMethod":false,"IsGenericMethodDefinition":false,"CustomAttributes":[],"IsCollectible":true},"ConstructorArguments":["(Int32)8"],"NamedArguments":[],"AttributeType":"System.Runtime.CompilerServices.CompilationRelaxationsAttribute"},{"Constructor":{"Name":".ctor","MemberType":"Constructor","DeclaringType":"System.Runtime.CompilerServices.RuntimeCompatibilityAttribute","ReflectedType":"System.Runtime.CompilerServices.RuntimeCompatibilityAttribute","MetadataToken":100000000,"Module":"System.Private.CoreLib.dll","MethodHandle":"System.RuntimeMethodHandle","Attributes":"PrivateScope, Public, HideBySig, SpecialName, RTSpecialName","CallingConvention":"Standard, HasThis","IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"ContainsGenericParameters":false,"MethodImplementationFlags":"Managed","IsAbstract":false,"IsConstructor":true,"IsFinal":false,"IsHideBySig":true,"IsSpecialName":true,"IsStatic":false,"IsVirtual":false,"IsAssembly":false,"IsFamily":false,"IsFamilyAndAssembly":false,"IsFamilyOrAssembly":false,"IsPrivate":false,"IsPublic":true,"IsConstructedGenericMethod":false,"IsGenericMethod":false,"IsGenericMethodDefinition":false,"CustomAttributes":[],"IsCollectible":true},"ConstructorArguments":[],"NamedArguments":["WrapNonExceptionThrows = True"],"AttributeType":"System.Runtime.CompilerServices.RuntimeCompatibilityAttribute"},{"Constructor":{"Name":".ctor","MemberType":"Constructor","DeclaringType":"System.Diagnostics.DebuggableAttribute","ReflectedType":"System.Diagnostics.DebuggableAttribute","MetadataToken":100000000,"Module":"System.Private.CoreLib.dll","MethodHandle":"System.RuntimeMethodHandle","Attributes":"PrivateScope, Public, HideBySig, SpecialName, RTSpecialName","CallingConvention":"Standard, HasThis","IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"ContainsGenericParameters":false,"MethodImplementationFlags":"Managed","IsAbstract":false,"IsConstructor":true,"IsFinal":false,"IsHideBySig":true,"IsSpecialName":true,"IsStatic":false,"IsVirtual":false,"IsAssembly":false,"IsFamily":false,"IsFamilyAndAssembly":false,"IsFamilyOrAssembly":false,"IsPrivate":false,"IsPublic":true,"IsConstructedGenericMethod":false,"IsGenericMethod":false,"IsGenericMethodDefinition":false,"CustomAttributes":[],"IsCollectible":true},"ConstructorArguments":["(System.Diagnostics.DebuggableAttribute\u002BDebuggingModes)263"],"NamedArguments":[],"AttributeType":"System.Diagnostics.DebuggableAttribute"}],"EscapedCodeBase":"file:///--filename--","Modules":[{"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":{},"MetadataToken":100000000,"ScopeName":"TooString.Specs.dll","Name":"TooString.Specs.dll","Assembly":{"CodeBase":"file:///--filename--","FullName":"TooString.Specs, Version=X.X.X.X, Culture=neutral, PublicKeyToken=null","EntryPoint":"Void Main(System.String[])","DefinedTypes":[],"IsCollectible":false,"ManifestModule":"TooString.Specs.dll","ReflectionOnly":false,"Location":"--filename--","ImageRuntimeVersion":"v4.0.30319","GlobalAssemblyCache":false,"HostContext":0,"IsDynamic":false,"ExportedTypes":[],"IsFullyTrusted":true,"CustomAttributes":[],"EscapedCodeBase":"file:///--filename--","Modules":[],"SecurityRuleSet":"None"},"ModuleHandle":{"MDStreamVersion":131072},"CustomAttributes":["[System.Runtime.CompilerServices.RefSafetyRulesAttribute((Int32)11)]"]}],"SecurityRuleSet":"None"}
                       """;
        //A
        var optionsD3 = TooStringOptions.ForJson(js => js.MaxDepth = 3);
        var actual = value.TooString(TooStringHow.Json, optionsD3);

        //A
        var comparableValue = actual.RegexReplaceKnownRuntimeVariableValues();
        var expandoString = JsonSerializer.Deserialize<ExpandoObject>(actual).TooString(TooStringHow.Json, optionsD3);
        var comparableExpandoString = expandoString.RegexReplaceKnownRuntimeVariableValues();
        TestContext.Progress.WriteLine(comparableExpandoString);

        Assert.That(comparableValue,Is.EqualTo(comparableExpandoString));

        Assert.That(comparableValue,Is.EqualTo(expected.RegexReplaceKnownRuntimeVariableValues()));
    }


    [Test]
    public void GivenAnUnJsonableReflectionType_Module()
    {
        var value = typeof(Type)
            .GetMethods(BindingFlags.Instance|BindingFlags.Public)
            .First(m=>m.Name=="GetMethods")
            .Module;

        var expected = """
                       {"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":{},"MetadataToken":100000000,"ScopeName":"System.Private.CoreLib.dll","Name":"System.Private.CoreLib.dll","Assembly":{"CodeBase":"file:///--filename--","FullName":"System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","EntryPoint":"null","DefinedTypes":[{"IsCollectible":false,"DeclaringMethod":"MethodBase","FullName":"Microsoft.CodeAnalysis.EmbeddedAttribute","AssemblyQualifiedName":"Microsoft.CodeAnalysis.EmbeddedAttribute, System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","Namespace":"Microsoft.CodeAnalysis","GUID":"00000000-0000-0000-0000-000000000000","GenericParameterAttributes":"GenericParameterAttributes","IsSZArray":false,"GenericParameterPosition":"Int32","ContainsGenericParameters":false,"StructLayoutAttribute":"System.Runtime.InteropServices.StructLayoutAttribute","Name":"EmbeddedAttribute","DeclaringType":"null","Assembly":"System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","BaseType":"System.Attribute","IsByRefLike":false,"IsConstructedGenericType":false,"IsGenericType":false,"IsGenericTypeDefinition":false,"IsGenericParameter":false,"IsTypeDefinition":true,"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MemberType":"TypeInfo","MetadataToken":100000000,"Module":"System.Private.CoreLib.dll","ReflectedType":"null","TypeHandle":"System.RuntimeTypeHandle","UnderlyingSystemType":"Microsoft.CodeAnalysis.EmbeddedAttribute","GenericTypeParameters":[],"DeclaredConstructors":[],"DeclaredEvents":[],"DeclaredFields":[],"DeclaredMembers":[],"DeclaredMethods":[],"DeclaredNestedTypes":[],"DeclaredProperties":[],"ImplementedInterfaces":[],"IsInterface":false,"IsNested":false,"IsArray":false,"IsByRef":false,"IsPointer":false,"IsGenericTypeParameter":false,"IsGenericMethodParameter":false,"IsVariableBoundArray":false,"HasElementType":false,"GenericTypeArguments":[],"Attributes":"AutoLayout, AnsiClass, Class, Sealed, BeforeFieldInit","IsAbstract":false,"IsImport":false,"IsSealed":true,"IsSpecialName":false,"IsClass":true,"IsNestedAssembly":false,"IsNestedFamANDAssem":false,"IsNestedFamily":false,"IsNestedFamORAssem":false,"IsNestedPrivate":false,"IsNestedPublic":false,"IsNotPublic":true,"IsPublic":false,"IsAutoLayout":true,"IsExplicitLayout":false,"IsLayoutSequential":false,"IsAnsiClass":true,"IsAutoClass":false,"IsUnicodeClass":false,"IsCOMObject":false,"IsContextful":false,"IsEnum":false,"IsMarshalByRef":false,"IsPrimitive":false,"IsValueType":false,"IsSignatureType":false,"TypeInitializer":"null","IsSerializable":false,"IsVisible":false,"CustomAttributes":[]},{"IsCollectible":false,"DeclaringMethod":"MethodBase","FullName":"System.Runtime.CompilerServices.IsUnmanagedAttribute","AssemblyQualifiedName":"System.Runtime.CompilerServices.IsUnmanagedAttribute, System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","Namespace":"System.Runtime.CompilerServices","GUID":"00000000-0000-0000-0000-000000000000","GenericParameterAttributes":"GenericParameterAttributes","IsSZArray":false,"GenericParameterPosition":"Int32","ContainsGenericParameters":false,"StructLayoutAttribute":"System.Runtime.InteropServices.StructLayoutAttribute","Name":"IsUnmanagedAttribute","DeclaringType":"null","Assembly":"System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","BaseType":"System.Attribute","IsByRefLike":false,"IsConstructedGenericType":false,"IsGenericType":false,"IsGenericTypeDefinition":false,"IsGenericParameter":false,"IsTypeDefinition":true,"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MemberType":"TypeInfo","MetadataToken":100000000,"Module":"System.Private.CoreLib.dll","ReflectedType":"null","TypeHandle":"System.RuntimeTypeHandle","UnderlyingSystemType":"System.Runtime.CompilerServices.IsUnmanagedAttribute","GenericTypeParameters":[],"DeclaredConstructors":[],"DeclaredEvents":[],"DeclaredFields":[],"DeclaredMembers":[],"DeclaredMethods":[],"DeclaredNestedTypes":[],"DeclaredProperties":[],"ImplementedInterfaces":[],"IsInterface":false,"IsNested":false,"IsArray":false,"IsByRef":false,"IsPointer":false,"IsGenericTypeParameter":false,"IsGenericMethodParameter":false,"IsVariableBoundArray":false,"HasElementType":false,"GenericTypeArguments":[],"Attributes":"AutoLayout, AnsiClass, Class, Sealed, BeforeFieldInit","IsAbstract":false,"IsImport":false,"IsSealed":true,"IsSpecialName":false,"IsClass":true,"IsNestedAssembly":false,"IsNestedFamANDAssem":false,"IsNestedFamily":false,"IsNestedFamORAssem":false,"IsNestedPrivate":false,"IsNestedPublic":false,"IsNotPublic":true,"IsPublic":false,"IsAutoLayout":true,"IsExplicitLayout":false,"IsLayoutSequential":false,"IsAnsiClass":true,"IsAutoClass":false,"IsUnicodeClass":false,"IsCOMObject":false,"IsContextful":false,"IsEnum":false,"IsMarshalByRef":false,"IsPrimitive":false,"IsValueType":false,"IsSignatureType":false,"TypeInitializer":"null","IsSerializable":false,"IsVisible":false,"CustomAttributes":[]},{"IsCollectible":false,"DeclaringMethod":"MethodBase","FullName":"System.Runtime.CompilerServices.NullableAttribute","AssemblyQualifiedName":"System.Runtime.CompilerServices.NullableAttribute, System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","Namespace":"System.Runtime.CompilerServices","GUID":"00000000-0000-0000-0000-000000000000","GenericParameterAttributes":"GenericParameterAttributes","IsSZArray":false,"GenericParameterPosition":"Int32","ContainsGenericParameters":false,"StructLayoutAttribute":"System.Runtime.InteropServices.StructLayoutAttribute","Name":"NullableAttribute","DeclaringType":"null","Assembly":"System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","BaseType":"System.Attribute","IsByRefLike":false,"IsConstructedGenericType":false,"IsGenericType":false,"IsGenericTypeDefinition":false,"IsGenericParameter":false,"IsTypeDefinition":true,"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MemberType":"TypeInfo","MetadataToken":100000000,"Module":"System.Private.CoreLib.dll","ReflectedType":"null","TypeHandle":"System.RuntimeTypeHandle","UnderlyingSystemType":"System.Runtime.CompilerServices.NullableAttribute","GenericTypeParameters":[],"DeclaredConstructors":[],"DeclaredEvents":[],"DeclaredFields":[],"DeclaredMembers":[],"DeclaredMethods":[],"DeclaredNestedTypes":[],"DeclaredProperties":[],"ImplementedInterfaces":[],"IsInterface":false,"IsNested":false,"IsArray":false,"IsByRef":false,"IsPointer":false,"IsGenericTypeParameter":false,"IsGenericMethodParameter":false,"IsVariableBoundArray":false,"HasElementType":false,"GenericTypeArguments":[],"Attributes":"AutoLayout, AnsiClass, Class, Sealed, BeforeFieldInit","IsAbstract":false,"IsImport":false,"IsSealed":true,"IsSpecialName":false,"IsClass":true,"IsNestedAssembly":false,"IsNestedFamANDAssem":false,"IsNestedFamily":false,"IsNestedFamORAssem":false,"IsNestedPrivate":false,"IsNestedPublic":false,"IsNotPublic":true,"IsPublic":false,"IsAutoLayout":true,"IsExplicitLayout":false,"IsLayoutSequential":false,"IsAnsiClass":true,"IsAutoClass":false,"IsUnicodeClass":false,"IsCOMObject":false,"IsContextful":false,"IsEnum":false,"IsMarshalByRef":false,"IsPrimitive":false,"IsValueType":false,"IsSignatureType":false,"TypeInitializer":"null","IsSerializable":false,"IsVisible":false,"CustomAttributes":[]}],"IsCollectible":false,"ManifestModule":{"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":{},"MetadataToken":100000000,"ScopeName":"System.Private.CoreLib.dll","Name":"System.Private.CoreLib.dll","Assembly":{"CodeBase":"file:///--filename--","FullName":"System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","EntryPoint":"null","DefinedTypes":[],"IsCollectible":false,"ManifestModule":"System.Private.CoreLib.dll","ReflectionOnly":false,"Location":"--filename--","ImageRuntimeVersion":"v4.0.30319","GlobalAssemblyCache":false,"HostContext":0,"IsDynamic":false,"ExportedTypes":[],"IsFullyTrusted":true,"CustomAttributes":[],"EscapedCodeBase":"file:///--filename--","Modules":[],"SecurityRuleSet":"None"},"ModuleHandle":{"MDStreamVersion":131072},"CustomAttributes":["[System.Runtime.CompilerServices.NullablePublicOnlyAttribute((Boolean)False)]","[System.Runtime.CompilerServices.SkipLocalsInitAttribute()]"]},"ReflectionOnly":false,"Location":"--filename--","ImageRuntimeVersion":"v4.0.30319","GlobalAssemblyCache":false,"HostContext":0,"IsDynamic":false,"ExportedTypes":[{"IsCollectible":false,"DeclaringMethod":"MethodBase","FullName":"Microsoft.Win32.SafeHandles.CriticalHandleMinusOneIsInvalid","AssemblyQualifiedName":"Microsoft.Win32.SafeHandles.CriticalHandleMinusOneIsInvalid, System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","Namespace":"Microsoft.Win32.SafeHandles","GUID":"00000000-0000-0000-0000-000000000000","GenericParameterAttributes":"GenericParameterAttributes","IsSZArray":false,"GenericParameterPosition":"Int32","ContainsGenericParameters":false,"StructLayoutAttribute":"System.Runtime.InteropServices.StructLayoutAttribute","Name":"CriticalHandleMinusOneIsInvalid","DeclaringType":"null","Assembly":"System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","BaseType":"System.Runtime.InteropServices.CriticalHandle","IsByRefLike":false,"IsConstructedGenericType":false,"IsGenericType":false,"IsGenericTypeDefinition":false,"IsGenericParameter":false,"IsTypeDefinition":true,"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MemberType":"TypeInfo","MetadataToken":100000000,"Module":"System.Private.CoreLib.dll","ReflectedType":"null","TypeHandle":"System.RuntimeTypeHandle","UnderlyingSystemType":"Microsoft.Win32.SafeHandles.CriticalHandleMinusOneIsInvalid","GenericTypeParameters":[],"DeclaredConstructors":[],"DeclaredEvents":[],"DeclaredFields":[],"DeclaredMembers":[],"DeclaredMethods":[],"DeclaredNestedTypes":[],"DeclaredProperties":[],"ImplementedInterfaces":[],"IsInterface":false,"IsNested":false,"IsArray":false,"IsByRef":false,"IsPointer":false,"IsGenericTypeParameter":false,"IsGenericMethodParameter":false,"IsVariableBoundArray":false,"HasElementType":false,"GenericTypeArguments":[],"Attributes":"AutoLayout, AnsiClass, Class, Public, Abstract, BeforeFieldInit","IsAbstract":true,"IsImport":false,"IsSealed":false,"IsSpecialName":false,"IsClass":true,"IsNestedAssembly":false,"IsNestedFamANDAssem":false,"IsNestedFamily":false,"IsNestedFamORAssem":false,"IsNestedPrivate":false,"IsNestedPublic":false,"IsNotPublic":false,"IsPublic":true,"IsAutoLayout":true,"IsExplicitLayout":false,"IsLayoutSequential":false,"IsAnsiClass":true,"IsAutoClass":false,"IsUnicodeClass":false,"IsCOMObject":false,"IsContextful":false,"IsEnum":false,"IsMarshalByRef":false,"IsPrimitive":false,"IsValueType":false,"IsSignatureType":false,"TypeInitializer":"null","IsSerializable":false,"IsVisible":true,"CustomAttributes":[]},{"IsCollectible":false,"DeclaringMethod":"MethodBase","FullName":"Microsoft.Win32.SafeHandles.CriticalHandleZeroOrMinusOneIsInvalid","AssemblyQualifiedName":"Microsoft.Win32.SafeHandles.CriticalHandleZeroOrMinusOneIsInvalid, System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","Namespace":"Microsoft.Win32.SafeHandles","GUID":"00000000-0000-0000-0000-000000000000","GenericParameterAttributes":"GenericParameterAttributes","IsSZArray":false,"GenericParameterPosition":"Int32","ContainsGenericParameters":false,"StructLayoutAttribute":"System.Runtime.InteropServices.StructLayoutAttribute","Name":"CriticalHandleZeroOrMinusOneIsInvalid","DeclaringType":"null","Assembly":"System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","BaseType":"System.Runtime.InteropServices.CriticalHandle","IsByRefLike":false,"IsConstructedGenericType":false,"IsGenericType":false,"IsGenericTypeDefinition":false,"IsGenericParameter":false,"IsTypeDefinition":true,"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MemberType":"TypeInfo","MetadataToken":100000000,"Module":"System.Private.CoreLib.dll","ReflectedType":"null","TypeHandle":"System.RuntimeTypeHandle","UnderlyingSystemType":"Microsoft.Win32.SafeHandles.CriticalHandleZeroOrMinusOneIsInvalid","GenericTypeParameters":[],"DeclaredConstructors":[],"DeclaredEvents":[],"DeclaredFields":[],"DeclaredMembers":[],"DeclaredMethods":[],"DeclaredNestedTypes":[],"DeclaredProperties":[],"ImplementedInterfaces":[],"IsInterface":false,"IsNested":false,"IsArray":false,"IsByRef":false,"IsPointer":false,"IsGenericTypeParameter":false,"IsGenericMethodParameter":false,"IsVariableBoundArray":false,"HasElementType":false,"GenericTypeArguments":[],"Attributes":"AutoLayout, AnsiClass, Class, Public, Abstract, BeforeFieldInit","IsAbstract":true,"IsImport":false,"IsSealed":false,"IsSpecialName":false,"IsClass":true,"IsNestedAssembly":false,"IsNestedFamANDAssem":false,"IsNestedFamily":false,"IsNestedFamORAssem":false,"IsNestedPrivate":false,"IsNestedPublic":false,"IsNotPublic":false,"IsPublic":true,"IsAutoLayout":true,"IsExplicitLayout":false,"IsLayoutSequential":false,"IsAnsiClass":true,"IsAutoClass":false,"IsUnicodeClass":false,"IsCOMObject":false,"IsContextful":false,"IsEnum":false,"IsMarshalByRef":false,"IsPrimitive":false,"IsValueType":false,"IsSignatureType":false,"TypeInitializer":"null","IsSerializable":false,"IsVisible":true,"CustomAttributes":[]},{"IsCollectible":false,"DeclaringMethod":"MethodBase","FullName":"Microsoft.Win32.SafeHandles.SafeHandleMinusOneIsInvalid","AssemblyQualifiedName":"Microsoft.Win32.SafeHandles.SafeHandleMinusOneIsInvalid, System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","Namespace":"Microsoft.Win32.SafeHandles","GUID":"00000000-0000-0000-0000-000000000000","GenericParameterAttributes":"GenericParameterAttributes","IsSZArray":false,"GenericParameterPosition":"Int32","ContainsGenericParameters":false,"StructLayoutAttribute":"System.Runtime.InteropServices.StructLayoutAttribute","Name":"SafeHandleMinusOneIsInvalid","DeclaringType":"null","Assembly":"System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","BaseType":"System.Runtime.InteropServices.SafeHandle","IsByRefLike":false,"IsConstructedGenericType":false,"IsGenericType":false,"IsGenericTypeDefinition":false,"IsGenericParameter":false,"IsTypeDefinition":true,"IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"MemberType":"TypeInfo","MetadataToken":100000000,"Module":"System.Private.CoreLib.dll","ReflectedType":"null","TypeHandle":"System.RuntimeTypeHandle","UnderlyingSystemType":"Microsoft.Win32.SafeHandles.SafeHandleMinusOneIsInvalid","GenericTypeParameters":[],"DeclaredConstructors":[],"DeclaredEvents":[],"DeclaredFields":[],"DeclaredMembers":[],"DeclaredMethods":[],"DeclaredNestedTypes":[],"DeclaredProperties":[],"ImplementedInterfaces":[],"IsInterface":false,"IsNested":false,"IsArray":false,"IsByRef":false,"IsPointer":false,"IsGenericTypeParameter":false,"IsGenericMethodParameter":false,"IsVariableBoundArray":false,"HasElementType":false,"GenericTypeArguments":[],"Attributes":"AutoLayout, AnsiClass, Class, Public, Abstract, BeforeFieldInit","IsAbstract":true,"IsImport":false,"IsSealed":false,"IsSpecialName":false,"IsClass":true,"IsNestedAssembly":false,"IsNestedFamANDAssem":false,"IsNestedFamily":false,"IsNestedFamORAssem":false,"IsNestedPrivate":false,"IsNestedPublic":false,"IsNotPublic":false,"IsPublic":true,"IsAutoLayout":true,"IsExplicitLayout":false,"IsLayoutSequential":false,"IsAnsiClass":true,"IsAutoClass":false,"IsUnicodeClass":false,"IsCOMObject":false,"IsContextful":false,"IsEnum":false,"IsMarshalByRef":false,"IsPrimitive":false,"IsValueType":false,"IsSignatureType":false,"TypeInitializer":"null","IsSerializable":false,"IsVisible":true,"CustomAttributes":[]}],"IsFullyTrusted":true,"CustomAttributes":[{"Constructor":"Void .ctor()","ConstructorArguments":[],"NamedArguments":[],"AttributeType":"System.Runtime.CompilerServices.ExtensionAttribute"},{"Constructor":"Void .ctor(Int32)","ConstructorArguments":[],"NamedArguments":[],"AttributeType":"System.Runtime.CompilerServices.CompilationRelaxationsAttribute"},{"Constructor":"Void .ctor()","ConstructorArguments":[],"NamedArguments":[],"AttributeType":"System.Runtime.CompilerServices.RuntimeCompatibilityAttribute"}],"EscapedCodeBase":"file:///--filename--","Modules":[{"MDStreamVersion":131072,"FullyQualifiedName":"--filename--","ModuleVersionId":"00000000-0000-0000-0000-000000000000","MetadataToken":100000000,"ScopeName":"System.Private.CoreLib.dll","Name":"System.Private.CoreLib.dll","Assembly":"System.Private.CoreLib, Version=X.X.X.X, Culture=neutral, PublicKeyToken=7cec85d7bea7798e","ModuleHandle":"System.ModuleHandle","CustomAttributes":[]}],"SecurityRuleSet":"None"},"ModuleHandle":{"MDStreamVersion":131072},"CustomAttributes":[{"Constructor":{"Name":".ctor","MemberType":"Constructor","DeclaringType":"System.Runtime.CompilerServices.NullablePublicOnlyAttribute","ReflectedType":"System.Runtime.CompilerServices.NullablePublicOnlyAttribute","MetadataToken":100000000,"Module":"System.Private.CoreLib.dll","MethodHandle":"System.RuntimeMethodHandle","Attributes":"PrivateScope, Public, HideBySig, SpecialName, RTSpecialName","CallingConvention":"Standard, HasThis","IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"ContainsGenericParameters":false,"MethodImplementationFlags":"Managed","IsAbstract":false,"IsConstructor":true,"IsFinal":false,"IsHideBySig":true,"IsSpecialName":true,"IsStatic":false,"IsVirtual":false,"IsAssembly":false,"IsFamily":false,"IsFamilyAndAssembly":false,"IsFamilyOrAssembly":false,"IsPrivate":false,"IsPublic":true,"IsConstructedGenericMethod":false,"IsGenericMethod":false,"IsGenericMethodDefinition":false,"CustomAttributes":[],"IsCollectible":true},"ConstructorArguments":["(Boolean)False"],"NamedArguments":[],"AttributeType":"System.Runtime.CompilerServices.NullablePublicOnlyAttribute"},{"Constructor":{"Name":".ctor","MemberType":"Constructor","DeclaringType":"System.Runtime.CompilerServices.SkipLocalsInitAttribute","ReflectedType":"System.Runtime.CompilerServices.SkipLocalsInitAttribute","MetadataToken":100000000,"Module":"System.Private.CoreLib.dll","MethodHandle":"System.RuntimeMethodHandle","Attributes":"PrivateScope, Public, HideBySig, SpecialName, RTSpecialName","CallingConvention":"Standard, HasThis","IsSecurityCritical":true,"IsSecuritySafeCritical":false,"IsSecurityTransparent":false,"ContainsGenericParameters":false,"MethodImplementationFlags":"Managed","IsAbstract":false,"IsConstructor":true,"IsFinal":false,"IsHideBySig":true,"IsSpecialName":true,"IsStatic":false,"IsVirtual":false,"IsAssembly":false,"IsFamily":false,"IsFamilyAndAssembly":false,"IsFamilyOrAssembly":false,"IsPrivate":false,"IsPublic":true,"IsConstructedGenericMethod":false,"IsGenericMethod":false,"IsGenericMethodDefinition":false,"CustomAttributes":[],"IsCollectible":true},"ConstructorArguments":[],"NamedArguments":[],"AttributeType":"System.Runtime.CompilerServices.SkipLocalsInitAttribute"}]}
                       """;
        
        //A
        var optionsD3 = TooStringOptions.ForJson(js => js.MaxDepth = 3);
        var actual = value.TooString(TooStringHow.Json, optionsD3);

        //A
        var comparableValue = actual.RegexReplaceKnownRuntimeVariableValues();
        var expandoString = JsonSerializer.Deserialize<ExpandoObject>(actual).TooString(TooStringHow.Json, optionsD3);
        var comparableExpandoString = expandoString.RegexReplaceKnownRuntimeVariableValues();
        TestContext.Progress.WriteLine(comparableExpandoString);

        Assert.That(comparableValue,Is.EqualTo(comparableExpandoString));

        Assert.That(comparableValue,Is.EqualTo(expected.RegexReplaceKnownRuntimeVariableValues()));
    }
#endif

}

class CompositeA
{
    public string? A { get; set; } public Complex? B { get; set; }

    public override string ToString() => new { A, B }.ToString()!;
}

class Circular { public string? A { get; set; } public Circular? B { get; set; } }
